import e,{useRef as r,useState as t,createContext as n,useContext as o}from"react";function a(){return(a=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}const l=e=>{if("multipart/form-data"===(e.enctype||"").toLowerCase())return new FormData(e);const r=new FormData(e),t={};for(let e of r.keys()){const n=e.replace(/\[\]$/,"");t[n]=r.getAll(e),1===t[n].length&&(t[n]=t[n][0]),""===t[n]&&delete t[n]}return t},c=n({});function i({children:e}){const{error:r,handled:t}=o(c);t.current=!0;const n=r?r.message:"";return e?"function"==typeof e?e(n,r):r?e:null:n||null}function u({children:e}){const{loading:r}=o(c);return"function"==typeof e?e(r):r?e:null}export default function({onSubmit:n,onError:o,onChange:i,autoReset:u,children:s,...f}){const d=r(!1),[p,g]=t(!1),[m,h]=t(!1);if(!n&&!i)throw new Error("onSubmit() callback is required");return e.createElement("form",a({onSubmit:async e=>{try{e.persist(),e.preventDefault(),g(!0),await n(l(e.target)),u&&e.target.reset()}catch(e){h(e),o?o(e):d.current||(e=>{console.error(e)})(e)}finally{g(!1)}},onChange:e=>i?i(l(e.currentTarget)):null},f),e.createElement(c.Provider,{value:{loading:p,error:m,handled:d}},e.createElement("fieldset",{style:{padding:0,margin:0,border:"none"},disabled:p},s)))}export{c as FormContext,i as FormError,u as FormLoading};
